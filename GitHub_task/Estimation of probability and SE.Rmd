---
title: "Estimation of probability and SE"
author: "NataliaLaskina"
date: "2024-09-30"
output: html_document
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)

```

## Параметры модели полного исцеления после проведения терапии

```{r}
true_prob <- 0.1  # Истинная вероятность полного исцеления
n_patients <- 100   # Количество пациентов
n_repeats <- 1000 # Количество повторений эксперимента

```

##Проведение экспериментов

```{r}
results <- tibble(
  n_exp = rep(1:n_repeats, each = n_patients),
  ID = rep(1:n_patients, n_repeats),
  estimated_prob = rbinom(n_repeats * n_patients, 1, true_prob)  
)

#Создается вектор n_exp, который содержит номера экспериментов от 1 до n_repeats. Каждый номер повторяется n_patients раз. Создается вектор ID, который содержит номера пациентов от 1 до n_patients. Каждый номер повторяется n_repeats раз.
#Вероятность выздороветь генерируется случайным образом. Функция rbinom() генерирует вектор из n_patients значений, где каждое значение — это 0 (если пациент не выздоровел) или 1 (если пациент выздоровел). Вероятность получения 1 (выздоровления) для каждого пациента равна true_prob. 
#Затем mean(outcomes) считает среднее значение этого вектора - это будет вероятность выздороветь по данной выборке. Т.е., мы генерируем случайные результаты лечения для всей группы с использованием истинной вероятности исцеления. #Например: если true_prob = 0.7 и n_patients = 10, то rbinom(n_patients, 1, true_prob) может возвратить вектор [1, 1, 0, 1, 1, 1, 0, 1, 1, 1]. Это означает, что 7 из 10 пациентов выздоровели. mean(outcomes) будет равна 0.7, что является оценкой вероятности исцеления для этой группы.
```

##Группировка и вычисление p и error по группам

```{r}
# Группируем данные по номеру эксперимента и считаем mean_prob и error для каждой группы.

group_stats <- results %>%
  group_by(n_exp) %>%
  summarise(
    mean_prob = mean(estimated_prob),
    error = mean_prob - true_prob  
  )
```

##Гистограмма

```{r}
#Строим гистограмму распределения средних вероятностей исцеления.

ggplot(group_stats, aes(x = mean_prob)) +
  geom_histogram(color = "black", fill = "white", binwidth = 0.02) +
  theme_bw()
```

##Оценка SE

```{r}
mean_error <- sqrt(mean(group_stats$error^2))
print(mean_error)
```

## Закономерности

Существует закономерность между средней ошибкой оценки вероятности,
истинной вероятностью и размером выборки. Стандартная ошибка обратно
пропорциональна корню квадратному из размера выборки. То есть, чем
больше выборка, тем меньше стандартная ошибка, и тем точнее будет
оценка. Также видно, что стандартная ошибка максимальна, когда p = 0.5
(50% вероятность). Это связано с тем, что при p = 0.5 дисперсия выборки
максимальна. А вот что при низкой p = 0.3, что при высокой p = 0.7
стандартная ошибка примерно одинакова (при одинаковой выборке).

Закономерность выражается формулой стандартной ошибки (standard error,
SE):

SE = sqrt(p \* (1-p) / n)

Где: • SE - стандартная ошибка оценки вероятности. • p - в данном
случае, истинная вероятность • n - размер выборки.

Например: • p = 0.7 • n = 10 Тогда стандартная ошибка будет: SE =
sqrt(0.7 \* (1 - 0.7) / 10) ≈ 0.145 Это означает, что в среднем оценки
вероятности исцеления в этом эксперименте будут отличаться от истинного
значения (0.7) примерно на 0.145.
