---
title: "Association_measures_tasks"
author: "NataliaLaskina"
date: "2024-10-01"
output: html_document
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, error = FALSE)
library(tidyverse)
```

# Первое задание

## Data reading

```{r}
diabetes <- read_csv('C:/Users/laskn/BioStat_2024/data/originals/diabetes.csv')
diabetes |> head()
```

### Checking dataset structure

```{r}
diabetes |> glimpse()

# Changing some variables type to factors
diabetes <- diabetes |> mutate(
  across(c(ИМТ, Диабет), ~ as.factor(.x))
)
```

### NA checking

```{r}
sum(is.na(diabetes))
```

### Summary output

```{r}
diabetes |> summary()
```

## Создание таблицы сопряженности

```{r}
table(diabetes$ИМТ, diabetes$Диабет)
```

## Некоторые необходимые расчеты

```{r}

high_imt_diabetes <- sum(diabetes$ИМТ == "Высокий" & diabetes$Диабет == "Есть")
high_imt_no_diabetes <- sum(diabetes$ИМТ == "Высокий" & diabetes$Диабет == "Нет")
normal_imt_diabetes <- sum(diabetes$ИМТ == "Нормальный" & diabetes$Диабет == "Есть")
normal_imt_no_diabetes <- sum(diabetes$ИМТ == "Нормальный" & diabetes$Диабет == "Нет") 

```

## Вычисление относительного риска (RR)

```{r}
RR <- (high_imt_diabetes / (high_imt_diabetes + high_imt_no_diabetes)) / 
  (normal_imt_diabetes / (normal_imt_diabetes + normal_imt_no_diabetes))
print(RR)
```

## Вычисление абсолютной разницы в рисках (RD)

```{r}
RD <- (high_imt_diabetes / (high_imt_diabetes + high_imt_no_diabetes)) - 
  (normal_imt_diabetes / (normal_imt_diabetes + normal_imt_no_diabetes))
print(RD)
```

## Интерпретация результатов.

RR больше 1, что говорит о том, что высокий ИМТ ассоциирован с
повышенным риском развития диабета 2-го типа. Риск развития диабета 2-го
типа у людей с высоким ИМТ в 2.24 раза выше, чем у людей с нормальным
ИМТ. RD показывает, насколько риск развития диабета 2-го типа выше у
людей с высоким ИМТ по сравнению с людьми с нормальным ИМТ. Риск
развития диабета 2-го типа на 0.33 больше у людей с высоким ИМТ по
сравнению с людьми с нормальным ИМТ.

# Второе задание

## Data reading

```{r}
pneumonia <- read_csv('C:/Users/laskn/BioStat_2024/data/originals/pneumonia.csv')
pneumonia |> head()
```

### Checking dataset structure

```{r}
pneumonia  |> glimpse()

# Changing some variables type to factors

pneumonia <- pneumonia |> mutate(
  across(c(Группа, "Торговый центр", Ресторан, "Общественные мероприятия"), ~ as.factor(.x))
)

```

### NA checking

```{r}
sum(is.na(pneumonia))
```

### Summary output

```{r}
pneumonia |> summary()
```

## Первый способ - отношение шансов, OR

### Анализ фактора торговый центр

```{r}

# Таблица для фактора Торговый центр

shopping_table <- with(pneumonia, table(`Торговый центр`, Группа))

# Шансы заболеть для тех, кто был в торговом центре

odds_yes_shopping <- shopping_table[1, 2] / shopping_table[1, 1]  

# Шансы для тех, кто не был в торговом центре

odds_no_shopping <- shopping_table[2, 2] / shopping_table[2, 1]  

# Отношение шансов заболеть для фактора торговый центр

OR_shopping <- odds_yes_shopping / odds_no_shopping

```

### Анализ фактора Ресторан

```{r}

# Таблица для фактора Ресторан

restaurant_table <- with(pneumonia, table(Ресторан, Группа))

# Шансы заболеть для тех, кто был в ресторане

odds_yes_restaurant <- restaurant_table[1, 2] / restaurant_table[1, 1]

# Шансы заболеть для тех, кто не был в ресторане

odds_no_restaurant <- restaurant_table[2, 2] / restaurant_table[2, 1]

# Отношение шансов для фактора Ресторан

OR_restaurant <- odds_yes_restaurant / odds_no_restaurant
```

### Анализ фактора Общественные мероприятия

```{r}

# Таблица для фактора Общественные мероприятия

events_table <- with(pneumonia, table(`Общественные мероприятия`, Группа))

# Шансы заболеть для тех, кто был на общественных мероприятиях

odds_yes_events <- events_table[1, 2] / events_table[1, 1]

# Шансы заболеть для тех, кто не был на общественных мероприятиях

odds_no_events <- events_table[2, 2] / events_table[2, 1]


# Отношение шансов для фактора Общественные мероприятия

OR_events <- odds_yes_events / odds_no_events

```

### Вывод результатов

```{r}

print("Отношение шансов заболеть (OR) для посещения торгового центра:")
print(OR_shopping)

print("Отношение шансов заболеть (OR) для посещения ресторана:")
print(OR_restaurant)

print("Отношение шансов заболеть (OR) для посещения общественных мероприятий:")
print(OR_events)

```

### Интерпретация результатов

Торговый центр: OR = 1.55. Это означает, что шансы заболеть пневмонией у
тех, кто посещал торговый центр, на 55% выше, чем у тех, кто не посещал
торговый центр.

Ресторан: OR = 1.1. Это означает, что шансы заболеть пневмонией у тех,
кто посещал ресторан, немного выше (на 10%), чем у тех, кто не посещал
ресторан.

Общественные мероприятия: OR = 0.98. Это означает, что шансы заболеть
пневмонией у тех, кто посещал общественные мероприятия, практически
такие же, как у тех, кто их не посещал (разница очень мала).

-   Вывод:

В этом исследовании, посещение торгового центра наиболее сильно связано
с возникновением пневмонии, а посещение ресторана имеет не сильно влияет
на шанс заболеть. Посещение общественных мероприятий взамосвязи с
появлением пневмонии не показывает.

-   Ограничения:

То, что одних и тех же людей опрашивали насчет посещения всех мест,
может повлиять на результаты исследования, так как:

-   Отсутствие независимости: мы сравниваем шансы заболеть для тех, кто
    был в торговом центре, с шансами для тех, кто не был. Но в нашем
    случае, люди, посетившие торговый центр, также могли посетить
    ресторан и общественные мероприятия.

-   Завышение связи: если определенный фактор (например, посещение
    общественных мероприятий) сильно связан с заболеванием, то это может
    “исказить” результаты для других факторов, потому что люди,
    посещавшие общественные мероприятия, также могли быть в торговом
    центре или ресторане.

Как это можно исправить:

-   Изменить дизайн исследования. Можно было бы разделить людей на
    несколько групп и сравнивать шансы заболеть только внутри каждой
    группы.

-   Использовать другой метод анализа. Например, можно построить модель
    логистической регрессии, которая учитывает все факторы одновременно
    и позволяет устранить влияние зависимости данных.

## Второй способ - логистическая модель

```{r}

Pneumonia <- pneumonia %>%
  rename(Пневмония = Группа)

# Переименование значений в столбце "Пневмония"

Pneumonia <- Pneumonia %>%
  mutate(
    Пневмония = ifelse(Пневмония == "Пневмония", "Да", "Нет")
  )

# Преобразование столбца "Пневмония" в фактор

Pneumonia$Пневмония <- as.factor(Pneumonia$Пневмония)

# Построение модели логистической регрессии

model <- glm(Пневмония ~ `Торговый центр` + Ресторан + `Общественные мероприятия`, 
             data = Pneumonia, family = binomial)

```

## Вывод результатов модели

```{r}

summary(model)

```

### Интерпретация результатов

Intercept: вероятность заболеть пневмонией для того, кто не посещал ни
торговый центр, ни ресторан, ни общественные мероприятия, значимо выше
нуля.

Торговый центр: коэффициент для “Торговый центрНет” = 0.444866 с
p-значением = 0.00255. Это означает, что посещение торгового центра
увеличивает вероятность заболеть пневмонией.

Ресторан: коэффициент для “РесторанНет” = 0.121399 с p-значением =
0.40896. Это означает, что посещение ресторана не имеет значимой
взаимосвязи с вероятностью заболеть пневмонией.

Общественные мероприятия: коэффициент для “Общественные мероприятияНет”
= -0.008137 с p-значением = 0.95581. Это означает, что посещение
общественных мероприятий не имеет значимой взаимосвязи с вероятностью
заболеть пневмонией.

-   Вывод:

Результаты модели показывают, что посещение торгового центра является
наиболее вероятным фактором, связанным с возникновением пневмонии в этом
исследовании. Результат совпал с оценкой первым способом, но мы также
отмели окончательно значимость взаимосвязи с посещением ресторана, и
увидели, что те, кто вообще никуда не ходил, тоже болеют.
